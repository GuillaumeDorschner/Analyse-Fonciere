<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Analyse üîç</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    var filters = {}
    var regions = [];
    var departements = [];
    var regionsOnly = false;
    var departementsOnly = false;

    $(document).ready(function () {
      function loadGraph(loadingId, contentId, containerId, graph, filters) {
        $(loadingId).show();
        $(contentId).hide();

        $.ajax({
          type: 'POST',
          url: `/get_graph/intra/{{annee}}/${graph}/`,
          contentType: 'html',
          data: JSON.stringify(filters),
          success: function (data) {
            $(loadingId).hide();
            $(contentId).show();
            $(containerId).html(data);
          },
          error: function (e) {
            $(loadingId).hide();
            $(contentId).show();
            $(containerId).html('Error occurred while loading the graph');
            console.log(e);
          }
        });
      }


      $('#filter-form').submit(function (e) {
        e.preventDefault();
        var form_data = $(this).serializeArray().reduce(function (a, x) { a[x.name] = x.value; return a; }, {});
        filters = form_data;
        console.log(filters);

        console.log(regions);
        console.log(departements);
        // loadAllGraph(filters);
      });



      $('#filter-region').change(function () {
        var region = $(this).val();
        regions.push(region);
        $('#selected-regions').append('<div><input type="checkbox" name="regions[]" value="' + region + '" checked> ' + region + '</div>');
      });

      $('#filter-departement').change(function () {
        var departement = $(this).val();
        departements.push(departement);
        $('#selected-departements').append('<div><input type="checkbox" name="departements[]" value="' + departement + '" checked> ' + departement + '</div>');
      });

      $(document).on('change', 'input[type="checkbox"]', function () {
        if (!this.checked) {
          var value = $(this).val();
          if ($(this).attr('name') === 'regions[]') {
            regions = regions.filter(function(item) {
              return item !== value
            });
          } else if ($(this).attr('name') === 'departements[]') {
            departements = departements.filter(function(item) {
              return item !== value
            });
          }
          $(this).parent().remove();
        }
      });

      $('#region-department-toggle').change(function () {
        regionsOnly = departementsOnly = this.checked;
      });

      function loadAllGraph(filters) {
        loadGraph('#loading_vente_par_mois', '#content_vente_par_mois', '#graph_vente_par_mois', 'vente_par_mois', filters);
        loadGraph('#loading_repartion_type_bien', '#content_repartion_type_bien', '#graph_repartion_type_bien', 'repartion_type_bien', filters);
        loadGraph('#loading_top_5_cher', '#content_top_5_cher', '#graph_container1', 'top_5_cher', filters);
        loadGraph('#loading_top_5_moins_cher', '#content_top_5_moins_cher', '#graph_top_5_moins_cher', 'top_5_moins_cher', filters);
        loadGraph('#loading_heatmap', '#content_heatmap', '#heatmap_container', 'heat_map', filters);
      }

      loadGraph();

    });
  </script>


</head>

<body>



  <div class="bg-white pb-6 sm:pb-8 lg:pb-12">
    <div class="mx-auto max-w-screen-xl px-4 md:px-8">
      <header class="mb-8 flex items-center justify-between py-4 md:mb-12 md:py-8 xl:mb-16">

        <a href="/" class="text-black-800 inline-flex items-center gap-2.5 text-2xl font-bold md:text-3xl"
          aria-label="logo">
          <svg width="95" height="94" viewBox="0 0 95 94" class="h-auto w-6 text-indigo-500" fill="currentColor"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M96 0V47L48 94H0V47L48 0H96Z" />
          </svg>
          Fonci√®re Analytica
        </a>


        <nav class="hidden gap-12 lg:flex">
          <a href="/"
            class="text-lg font-semibold text-gray-600 transition duration-100 hover:text-indigo-500 active:text-indigo-700">Home</a>
          <a href="/analyse" class="text-lg font-semibold text-indigo-500">Analyse</a>
          <a href="/about"
            class="text-lg font-semibold text-gray-600 transition duration-100 hover:text-indigo-500 active:text-indigo-700">About</a>
        </nav>
        <a href="#" class=""></a>

      </header>
    </div>
  </div>

  <div class="mx-auto max-w-screen-xl px-4 md:px-8">
    <!-- template-->

    <h2 class="text-4xl font-bold">Analyse de {{anne}}</h2>

    </br>
    </br>

    <form id="filter-form">
      <div class="flex flex-wrap -mx-3 mb-6">
        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="filter-type">
            Type de bien
          </label>
          <select
            class="block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
            id="filter-type" name="type">
            <option value="">Tous</option>
            <option value="Maison">Maison</option>
            <option value="Appartement">Appartement</option>
          </select>
        </div>
        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="filter-price">
            Prix maximum
          </label>
          <input
            class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
            id="filter-price" name="price" type="number" placeholder="100000">
        </div>

        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="filter-region">
            R√©gion
          </label>
          <select
            class="block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
            id="filter-region" name="region">
            <option value="">Toutes</option>
            {% for region in regions %}
            <option value="{{ region }}">{{ region }}</option>
            {% endfor %}
          </select>
          <div id="selected-regions">
            <!-- r√©gions checkbox -->
          </div>
        </div>
        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="filter-departement">
            D√©partement
          </label>
          <select
            class="block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
            id="filter-departement" name="departement">
            <option value="">Tous</option>
            {% for departement in departements %}
            <option value="{{ departement }}">{{ departement }}</option>
            {% endfor %}
          </select>
          <div id="selected-departements">
            <!-- d√©partements checkbox -->
          </div>
        </div>

        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="region-department-toggle">
            Filtrer seulement par R√©gions / D√©partements
          </label>
          <input type="checkbox" id="region-department-toggle" name="region-department-toggle">
        </div>
    
        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="filter-area">
            Surface Carrez maximum
          </label>
          <input
            class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
            id="filter-area" name="area" type="number" placeholder="Surface Carrez maximum">
        </div>
        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="filter-start-date">
            Date de d√©but
          </label>
          <input
            class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
            id="filter-start-date" name="start-date" type="date" placeholder="2018-01-01">
        </div>
        <div class="w-full md:w-1/4 px-3 mb-6 md:mb-0">
          <label class="block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2" for="filter-end-date">
            Date de fin
          </label>
          <input
            class="appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500"
            id="filter-end-date" name="end-date" type="date" placeholder="2018-12-31">
        </div>

      </div>
      <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" type="submit">
        Filtrer
      </button>
    </form>



    vente_par_mois
    <div id="loading_vente_par_mois" class="loading" style="display: none;">
      <h2>Loading...</h2>
    </div>

    <div id="content_vente_par_mois" class="content" style="display: none;">
      <div id="graph_vente_par_mois">
        <h2>vente_par_mois</h2>
      </div>
    </div>


    repartion_type_bien
    <div id="loading_repartion_type_bien" class="loading" style="display: none;">
      <h2>Loading...</h2>
    </div>

    <div id="content_repartion_type_bien" class="content" style="display: none;">
      <div id="graph_repartion_type_bien">
        <h2>repartion_type_bien</h2>
      </div>
    </div>

    top_5_cher
    <div id="loading_top_5_cher" class="loading" style="display: none;">
      <h2>Loading...</h2>
    </div>

    <div id="content_top_5_cher" class="content" style="display: none;">
      <div id="graph_top_5_cher">
        <h2>top_5_cher</h2>
      </div>
    </div>

    top_5_moins_cher
    <div id="loading_top_5_moins_cher" class="loading" style="display: none;">
      <h2>Loading...</h2>
    </div>

    <div id="content_top_5_moins_cher" class="content" style="display: none;">
      <div id="graph_top_5_moins_cher">
        <h2>top_5_moins_cher</h2>
      </div>
    </div>

    heatMap

    <div id="loading_heatmap" class="loading" style="display: none;">
      <h2>Loading...</h2>
    </div>

    <div id="content_heatmap" class="content" style="display: none;">
      <div id="heatmap_container">
        <h2>Heatmap</h2>
      </div>
    </div>



    <!-- template-->
  </div>

  <div class="bg-gray-900">
    <footer class="mx-auto max-w-screen-2xl px-4 md:px-8">
      <div class="mb-16 grid grid-cols-2 gap-12 pt-10 md:grid-cols-4 lg:grid-cols-6 lg:gap-8 lg:pt-12">
        <div class="col-span-full lg:col-span-2">

        </div>



        <div>
          <div class="mb-4 font-bold uppercase tracking-widest text-gray-100">Legal</div>

          <nav class="flex flex-col gap-4">

            <div>
              <a href="#"
                class="text-gray-400 transition duration-100 hover:text-indigo-500 active:text-indigo-600">Politique
                de confidentialit√©</a>
            </div>

            <div>
              <a href="#"
                class="text-gray-400 transition duration-100 hover:text-indigo-500 active:text-indigo-600">Param√®tres
                des cookies</a>
            </div>
          </nav>
        </div>

      </div>

      <div class="border-t border-gray-800 py-8 text-center text-sm text-gray-400">¬© 2023 - Analyse Fonci√®re</div>
    </footer>
  </div>

</body>

</html>
